<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Batman1788 Menu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-5DBPBMP3K1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-5DBPBMP3K1');
  </script>
  <style>
    :root {
      --bat-black: #18191b;
      --bat-card: rgba(35,36,39,0.90);
      --bat-gold: #ffe02e;
      --bat-yellow: #ffdf2b;
      --bat-gray: #eee;
    }
    body {
      margin: 0; background: var(--bat-black); color: #fff;
      font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif;
    }
    .header {
      padding: 14px 0 7px 0;
      text-align: center;
      font-size: 1.25em;
      font-weight: 800;
      letter-spacing: 2px;
      background: var(--bat-black);
      color: var(--bat-gold);
      text-shadow: 0 2px 24px #000, 0 1px 0 #fff3;
      border-bottom: 1.5px solid #2c2c2e;
      position: sticky; top: 0; z-index: 9;
    }
    .header .bat-logo {
      font-size: 1.4em;
      vertical-align: middle;
      margin-right: 9px;
      filter: drop-shadow(0 2px 4px #ffe02e55);
    }
    .marquee-wrap {
      background: #2a2927;
      border-bottom: 1.2px solid #282828;
      overflow: hidden;
      position: sticky;
      top: 0;
      z-index: 22;
      height: 38px;
    }
    .marquee-text {
      color: var(--bat-gold);
      font-size: 1.03em; font-weight: 600; line-height:38px;
      white-space: nowrap;
      position: sticky;top: 0;z-index: 22;
      will-change: transform;
      text-shadow:0 1px 10px #0006;
    }
    .menu-wrap { max-width: 530px; margin: 0 auto; padding: 18px 0 70px 0;}
    .menu-item {
      display: flex; 
      background: var(--bat-card); 
      border-radius: 18px;
      box-shadow: 0 3px 14px #ffe02e1b, 0 0 0 1.6px #ffe02e33;
      margin:0 12px 18px 12px; 
      padding: 13px 12px 18px 12px; 
      align-items: flex-start;
      border: 1.2px solid var(--bat-gold);
      transition:.15s;
      position: relative;
      flex-direction: row;
      overflow: hidden;
    }
    .menu-item::before {
      content: "";
      position: absolute;
      inset: 0;
      background: url('https://raw.githubusercontent.com/ha05di/batman1788shop/main/logo.png') center center/85% no-repeat;
      opacity: 0.23;
      pointer-events: none;
      z-index: 0;
    }
    .menu-item > * { position: relative; z-index: 1; }
    .menu-img {
      width: 68px; height: 68px; border-radius: 13px; object-fit: cover;
      background: #252323; margin-right: 13px; border: 1.3px solid var(--bat-gold);
      box-shadow:0 2px 10px #ffe02e3a;
      flex-shrink: 0;
      cursor: pointer;
      transition: box-shadow .18s;
    }
    .menu-img:hover { box-shadow:0 4px 20px #ffe02ea0; }
    .menu-info { flex:1; min-width: 0; display:flex; flex-direction:column;}
    .menu-name {
      font-size: 1.35em; font-weight: 700; margin-bottom: 2.5px;
      color: var(--bat-gold); display: flex; align-items:center;
      text-shadow: 0 2px 7px #ffe02e1a, 0 0px 1px #000;
      flex-wrap: wrap;
    }
    .menu-badge {
      display: inline-block; background: linear-gradient(90deg, #ffe02e, #ffc400);
      color: #111; border-radius: 9px; font-size: .83em; font-weight: 600;
      padding: 2px 9px 2px 9px; margin-left: 7px; margin-right: 4px; letter-spacing: 1px;
      box-shadow:0 1px 5px #ffe02e44;
    }
    .menu-type {
      display:inline-block; background: #303030; color:var(--bat-gold);
      font-size:.8em; border-radius:7px; padding:2px 8px; margin-left:6px;
      border:1px solid #ffe02e2c;
    }
    .menu-title { color:var(--bat-gold); font-size:.95em; margin-bottom:1px; margin-right:4px;}
    .menu-thccbd { color:#ffe02e; font-size:0.97em; font-weight:500; margin-bottom:2px; margin-right:10px;}
    .menu-desc { font-size:.97em; color:#f8f6c7; margin:7px 0 0 0; line-height:1.48; text-shadow:0 1px 4px #1a17084f;}
    .menu-bottom-prices {
      display: flex;
      gap: 13px;
      justify-content: flex-start;
      margin-top: 17px;
      position: static;
      padding: 0 4px 0 4px;
      flex-wrap: wrap;
    }
    .menu-spec {
      background: #2d2c22; color:var(--bat-gold); font-size:1.01em; border-radius:7px;
      padding:2px 13px; margin-right:2px; display:inline-block; border:1.1px solid #ffe02e;
      box-shadow:0 1px 6px #ffe02e22;
      margin-bottom:0;
      font-weight: 900;
    }
    .menu-price {
      color: #ffe02e; font-weight: 900; font-size:1.08em; margin-left:4px;
      text-shadow: 0 2px 7px #ffe02e1a, 0 0px 1px #000;
    }
    .footer { position:fixed; left:0; bottom:0; width:100vw; color:#ffc400; background:#18191b;
      font-size:.98em; text-align:center; padding:12px 0 9px 0; z-index:22; border-top: 1.5px solid #2c2c2e;}
    a { color: #ffe02e; text-decoration:underline; }
    @media (max-width:700px) {
      .menu-wrap { padding: 5px 0 63px 0;}
      .menu-item { margin: 0 3vw 15px 3vw; padding: 10px 5px 18px 5px;}
      .menu-img { width:54px; height:54px; margin-right:7px;}
      .menu-name { font-size: 1em;}
    }
    @media (max-width:400px){
      .menu-item { flex-direction: column; align-items: stretch;}
      .menu-img { margin: 0 0 10px 0; }
      .menu-bottom-prices { justify-content: center; gap: 7px;}
    }
    /* 图片放大弹窗 */
    .img-modal-bg {
      position: fixed; left: 0; top: 0; width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.75); display: none; justify-content: center; align-items: center; z-index: 9999;
    }
    .img-modal-bg.active { display: flex; }
    .img-modal-bg img { max-width: 90vw; max-height: 84vh; border-radius: 16px; box-shadow: 0 2px 28px #000a; background: #111;}
    /* 悬浮客服按钮 */
    .contact-fab {
      position: fixed;
      right: 21px;
      bottom: 26px;
      z-index: 2000;
      background: #ffe02e;
      border-radius: 50%;
      box-shadow: 0 3px 18px #0006;
      padding: 0;
      width: 52px;
      height: 52px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: box-shadow .16s,transform .12s;
      border: none;
      text-decoration: none;
    }
    .contact-fab:hover {
      box-shadow: 0 7px 28px #ffe02e55;
      transform: scale(1.08);
    }
    @media (max-width: 480px){
      .contact-fab { right: 12px; bottom: 12px; width: 44px; height: 44px;}
      .contact-fab svg { width: 22px; height: 22px;}
    }
  </style>
</head>
<body>
  <div class="header">
    <span class="bat-logo"></span> Batman1788 Menu
  </div>
  <div class="marquee-wrap">
    <div class="marquee-inner" id="marqueeInner" style="white-space:nowrap;display:flex;">
      <span class="marquee-text" id="marqueeText"></span>
      <span class="marquee-text" id="marqueeTextClone"></span>
    </div>
  </div>
  <div class="menu-wrap" id="menu"></div>
  <div class="footer">
    Batman1788 &copy; Menu | <a href="https://t.me/batman1788" target="_blank">Telegram Order</a>
  </div>

  <!-- 悬浮客服按钮 -->
  <a href="https://t.me/batman1788" target="_blank" class="contact-fab" title="Customer Service">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="#fff" style="vertical-align:middle">
      <circle cx="12" cy="12" r="12" fill="#ffe02e" />
      <path d="M17 10.5c0-.83-.67-1.5-1.5-1.5h-7C7.67 9 7 9.67 7 10.5v3c0 .83.67 1.5 1.5 1.5H9v2l3-2h3.5c.83 0 1.5-.67 1.5-1.5v-3z" fill="#18191b"/>
    </svg>
  </a>

  <!-- 图片弹窗组件 -->
  <div class="img-modal-bg" id="imgModal" onclick="this.classList.remove('active')">
    <img id="imgModalPic" src="" />
  </div>

  <script>
    // ---- 修改这里即可 ----
    const SHEET_ID = "1hUlRnvEy-k2Arz8SVKpRsAaBEFTyS6RDJBDfwDmM-Hs";
    const SHEET_TAB_MENU = "batmenu";
    const SHEET_TAB_NOTICE = "notice";
    const MENU_URL = `https://opensheet.elk.sh/${SHEET_ID}/${SHEET_TAB_MENU}`;
    const NOTICE_URL = `https://opensheet.elk.sh/${SHEET_ID}/${SHEET_TAB_NOTICE}`;
    const AD_URL     = `https://opensheet.elk.sh/${SHEET_ID}/ad`;

    // ---- 广告开关 ----
    fetch(AD_URL)
      .then(res=>res.json())
      .then(rows=>{
        if(rows.length > 0 && rows[0].enabled && rows[0].enabled.toLowerCase() === "yes"){
          const adImg = rows[0].img || "";
          if(adImg){
            document.querySelector("#adModal img").src = adImg;
            document.getElementById("adModal").style.display = "flex";
          }
        }
      })
      .catch(err=>console.error("广告加载失败", err));

    // 跑马灯: 第一条永远显示，第二条起每天澳洲10AM轮换
    fetch(NOTICE_URL)
      .then(res=>res.json())
      .then(rows=>{
        let notices = rows.map(r=>r.msg).filter(Boolean);
        let mainMsg = notices[0] || "";
        let others = notices.slice(1);

        // 墨尔本时区每天10AM切换
        let now = new Date();
        let melTime = new Date(now.toLocaleString("en-US", {timeZone: "Australia/Melbourne"}));
        let localDate = melTime.getFullYear() * 372 + (melTime.getMonth()+1)*31 + melTime.getDate();
        if (melTime.getHours() < 10) {
          melTime.setDate(melTime.getDate()-1);
          localDate = melTime.getFullYear() * 372 + (melTime.getMonth()+1)*31 + melTime.getDate();
        }

        let oneMsg = "";
        if (others.length > 0) {
          oneMsg = others[(localDate % others.length)];
        }
        let showText = mainMsg;
        if (oneMsg) showText += "   |   " + oneMsg;

        const marquee = document.getElementById('marqueeText');
        const clone = document.getElementById('marqueeTextClone');
        marquee.innerText = showText;
        clone.innerText = showText;

        const inner = document.getElementById('marqueeInner');
        let speed = 1.2;
        let pos = 0;
        function scroll() {
          let unitWidth = marquee.offsetWidth;
          pos -= speed;
          if (Math.abs(pos) >= unitWidth) pos = 0;
          inner.style.transform = `translateX(${pos}px)`;
          requestAnimationFrame(scroll);
        }
        setTimeout(scroll, 350);
      });

    // 放大图片函数
    window.showImgModal = function(src){
      document.getElementById('imgModalPic').src = src;
      document.getElementById('imgModal').classList.add('active');
    }

    // 菜单
    fetch(MENU_URL)
      .then(res=>res.json())
      .then(rows=>{
        const html = rows.map(obj=>{
          // 多规格价钱
          let priceBtns = '';
          for(let i=1;i<=3;i++){
            if(obj['spec'+i] && obj['price'+i]){
              priceBtns += `<span class="menu-spec">${obj['spec'+i]} <span class="menu-price">${obj['price'+i]}</span></span>`;
            }
          }
          let thccbd = obj.thccbd || '';
          if(!thccbd && (obj.thc || obj.cbd)) thccbd = (obj.thc?obj.thc:'')+(obj.cbd?(' / '+obj.cbd):'');

          return `
            <div class="menu-item">
              ${obj.img ? `<img class="menu-img" src="${obj.img}" loading="lazy" onclick="showImgModal('${obj.img}')"/>` : ""}
              <div class="menu-info">
                <div class="menu-name">
                  ${obj.name || ""}
                  ${obj.badge ? `<span class="menu-badge">${obj.badge}</span>` : ""}
                  ${obj.type ? `<span class="menu-type">${obj.type}</span>` : ""}
                </div>
                <div style="display:flex;align-items:center;gap:9px;margin-bottom:2px;">
                  ${obj.title ? `<span class="menu-title">${obj.title}</span>` : ""}
                  ${thccbd ? `<span class="menu-thccbd">THC/CBD: ${thccbd}</span>` : ""}
                </div>
                ${obj.desc ? `<div class="menu-desc">${obj.desc}</div>` : ""}
                <div class="menu-bottom-prices">${priceBtns}</div>
              </div>
            </div>
          `;
        }).join('');
        document.getElementById('menu').innerHTML = html || `<div style="text-align:center;color:#ccc;margin-top:40px;">暂无菜单内容</div>`;
      })
      .catch(err=>{
        document.getElementById('menu').innerHTML = "<div style='text-align:center;color:var(--bat-gold);margin-top:36vw;font-size:1.08em;'>菜单加载失败，请刷新重试。</div>";
        console.error(err);
      });
  </script>
<!-- 🔽 广告弹窗 🔽 -->
<div class="ad-modal-bg" id="adModal" style="display:none">
  <div class="ad-modal">
    <img src="" alt="Promo" />
    <button class="ad-close" onclick="closeAd()">×</button>
  </div>
</div>

<style>
  /* 广告弹窗样式 */
  .ad-modal-bg {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.78);
    display: none;  /* 默认隐藏 */
    align-items: center; justify-content: center;
    z-index: 10000;
  }
  .ad-modal {
    position: relative;
    max-width: 90vw; max-height: 80vh;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 4px 25px #000a;
    animation: popIn .35s ease;
  }
  .ad-modal img {
    width: 100%; height: auto; display:block;
    background: #111;
  }
  .ad-close {
    position: absolute; top: 6px; right: 6px;
    background: rgba(0,0,0,0.6); color: #fff;
    border: none; border-radius: 50%;
    width: 32px; height: 32px;
    font-size: 20px; font-weight: bold;
    cursor: pointer;
    line-height: 30px;
  }
  .ad-close:hover { background: rgba(0,0,0,0.85); }
  @keyframes popIn {
    from { transform: scale(0.85); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }
</style>

<script>
  // 关闭广告
  function closeAd(){
    const m = document.getElementById('adModal');
    if (m) m.style.display = 'none';
  }

  // 点击背景关闭
  (function(){
    const m = document.getElementById('adModal');
    if (!m) return;
    m.addEventListener('click', function(e){
      if (e.target.id === 'adModal') closeAd();
    });
  })();

  // ---- 从 Google Sheet 控制广告 ----
  const AD_URL = `https://opensheet.elk.sh/${SHEET_ID}/ad`;

  fetch(AD_URL)
    .then(res => res.json())
    .then(rows => {
      if (!(rows?.length)) return;
      const r = rows[0] || {};
      const enabled = String(r.enabled || '').toLowerCase() === 'yes';
      const adImg = r.img || '';
      if (!enabled || !adImg) return;

      // 设置广告图片并显示
      document.querySelector('#adModal img').src = adImg;
      document.getElementById('adModal').style.display = 'flex';
    })
    .catch(err => console.error('广告加载失败', err));
</script>
<!-- 🔼 广告弹窗 🔼 -->
</body>
</html>



